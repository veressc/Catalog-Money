<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalog-Money</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <form method="get" id="search-form">
        <div class="row g-3">
            <div class="col">
                <input type="text" id="search" name="search" value="{{ search or '' }}" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" autocomplete="off">
                <ul id="autocomplete-list" class="list-group mt-2"></ul>
            </div>
            <div class="col">
                <input type="number" step="0.01" name="price_min" value="{{ price_min or '' }}" class="form-control" placeholder="–¶–µ–Ω–∞ –æ—Ç">
            </div>
            <div class="col">
                <input type="number" step="0.01" name="price_max" value="{{ price_max or '' }}" class="form-control" placeholder="–¶–µ–Ω–∞ –¥–æ">
            </div>
            <div class="col">
                <select name="sort" class="form-select">
                    <option value="name" {{ 'selected' if sort_by == 'name' else '' }}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                    <option value="price" {{ 'selected' if sort_by == 'price' else '' }}>–ü–æ —Ü–µ–Ω–µ</option>
                </select>
            </div>
            <div class="col">
                <button class="btn btn-primary" type="submit">üîç –ù–∞–π—Ç–∏
                </button>
            </div>
        </div>
    </form>

    <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <ul class="list-group mt-4">
        {% for product in products %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <a href="{{ url_for('main.product_detail', product_id=product.id) }}">
                        <strong>{{ product.name }}</strong>
                    </a>
                    <br>
                    <small class="text-muted">{{ product.description }}</small>
                </div>
                <span class="badge bg-success fs-6">{{ product.price }} ‚ÇΩ</span>
            </li>
        {% else %}
            <li class="list-group-item text-center">
                –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º ü§î
            </li>
        {% endfor %}
    </ul>
</div>

<!-- JavaScript –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('search');
        const autocompleteList = document.getElementById('autocomplete-list');

        searchInput.addEventListener('input', function () {
            const query = searchInput.value;

            if (query.length < 1) {
                autocompleteList.innerHTML = '';
                return;
            }

            fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    autocompleteList.innerHTML = '';

                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.classList.add('list-group-item', 'list-group-item-action');
                        li.textContent = item;

                        li.addEventListener('click', function () {
                            searchInput.value = item;
                            autocompleteList.innerHTML = '';
                        });

                        autocompleteList.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–µ:', error);
                });
        });
    });
</script>

</body>
</html>